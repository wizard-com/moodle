define ("theme_snap/pm_course_cards",["jquery","core/log","core/templates","theme_snap/pm_course_favorites","theme_snap/model_view","theme_snap/ajax_notification","theme_snap/util","theme_snap/appear"],function(a,b,c,d,e,f,g,h){return new function CourseCards(){var i=this;this.applyCourseInfo=function(d){c.render("theme_snap/course_cards",[]).done(function(){for(var c in d){var f=d[c];b.debug("applying course data for courseid "+f.course);var g=a(".coursecard[data-courseid=\""+f.course+"\"]");e(g,"theme_snap/course_cards");a(g).trigger("modelUpdate",f)}})};this.reqCourseInfo=function(c){if(0===c.length){return}var d="courseids="+c.join(","),e=M.cfg.sesskey+"coursecard";b.debug("fetching course data");a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:d,success:function success(a){f.ifErrorShowBestMsg(a).done(function(c){if(c){}else{if(a.info){b.debug("fetched coursedata",a.info);if(g.supportsSessionStorage()){window.sessionStorage[e]=JSON.stringify(a.info)}i.applyCourseInfo(a.info)}else{b.warn("fetched coursedata with error: JSON data object is missing info property",a)}}})}})};this.getCourseIds=function(){var b=[];a(".coursecard").each(function(){b.push(a(this).attr("data-courseid"))});return b};this.applyAppearForImages=function(){h(document.body).on("appear",".coursecard",function(b,c){c.each(function(){var b=a(this).data("image-url");if(b!==void 0){var c=a(this);a("<img src=\""+b.trim()+"\" />").on("load",function(){a(c).css("background-image","url("+b.trim()+")")})}})});function b(){var a,b=document.createElement("fakeelement"),c="Animationend",d={Animation:"Animationend",OAnimation:"oAnimationEnd",MozAnimation:"Animationend",WebkitAnimation:"webkitAnimationEnd"};for(a in d){if(b.style[a]!==void 0){c=d[a];break}}return c}a("#snap-pm-courses .nav-tabs .nav-link").on("click",function(){var c=a(this).attr("href");a(c)[0].addEventListener(b(),function(){a.force_appear()},!1)});a(".coursecard").appear({appeartopoffset:100,appearleftoffset:100});h.force_appear()};this.init=function(){a(document).ready(function(){d();var a=i.getCourseIds(),b=M.cfg.sesskey+"coursecard";if(0<a.length){i.applyAppearForImages();if(g.supportsSessionStorage()&&window.sessionStorage[b]){var c=JSON.parse(window.sessionStorage[b]);i.applyCourseInfo(c)}else{i.reqCourseInfo(a)}}});a(document).on("click",".coursecard[data-href]",function(b){var c=a(b.target);if(!a(c).closest("a").length){window.open(a(this).data("href"),"_self");b.preventDefault()}})}}});
//# sourceMappingURL=pm_course_cards.min.js.map
