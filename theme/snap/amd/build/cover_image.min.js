define ("theme_snap/cover_image",["jquery","core/log","core/ajax","core/notification","theme_snap/ajax_notification"],function(a,b,c,d,e){var f=function(b,c){var d=M.util.get_string("closebuttontitle","moodle");if(!a(b).length){a("#snap-coverimagecontrol").before("<div id=\""+b+"\" class=\"snap-alert-cover-image alert alert-warning\" role=\"alert\">"+c+"<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\""+d+"\"><span aria-hidden=\"true\">&times;</span></button></div>")}},g=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","kB","MB","GB","TB"][b]},h=function(){a("#snap-changecoverimageconfirmation .ok").removeClass("ajaxing");a("#snap-alert-cover-image-size").remove();a("#snap-alert-cover-image-bytes").remove();a("label[for=\"snap-coverfiles\"]").removeClass("ajaxing");a("#snap-changecoverimageconfirmation").removeClass("state-visible");a("label[for=\"snap-coverfiles\"]").addClass("state-visible");a("#snap-coverfiles").val("")},i=function(){a("#snap-alert-cover-image-upload-failed").remove();a("#snap-changecoverimageconfirmation").removeClass("disabled");a("label[for=\"snap-coverfiles\"]").removeClass("state-visible");a("#snap-changecoverimageconfirmation").addClass("state-visible");a("body").removeClass("cover-image-change")},j=function(b,d){a("#page-header").data("servercoverfile",a("#page-header").css("background-image"));a("#changecoverimage").click(function(b){b.preventDefault();a(this).removeClass("state-visible");a("label[for=\"snap-coverfiles\"]").addClass("state-visible")});var j,k;a("#snap-coverfiles").on("change",function(c){a("body").addClass("cover-image-change");var d=c.target.files;if(!d.length){return}j=d[0];if(!j.type.match("image.*")){return}var e=new FileReader;a("label[for=\"snap-coverfiles\"]").addClass("ajaxing");e.onload=function(c){return function(d){k=d.target.result;a(".path-course-view #page-header").addClass("mast-image");a(".path-course-view #page-header .breadcrumb-item a").addClass("mast-breadcrumb");var e=b;if(c.size>e){h();var j=g(e),l=M.util.get_string("error:coverimageexceedsmaxbytes","theme_snap",j);f("snap-alert-cover-image-bytes",l);return}else{a("#snap-alert-cover-image-bytes").remove()}var m=a("<img />");m=m.get(0);m.src=k;a(m).on("load",function(){if(1024>m.width){f("snap-alert-cover-image-size",M.util.get_string("error:coverimageresolutionlow","theme_snap"))}else{a("#snap-alert-cover-image-size").remove()}});a("#page-header").css("background-image","url("+k+")");a("#page-header").data("localcoverfile",c.name);i()}}(j);e.readAsDataURL(j)});a("#snap-changecoverimageconfirmation .ok").click(function(){if(a(this).parent().hasClass("disabled")){return}a("#snap-alert-cover-image-size").remove();a("#snap-alert-cover-image-bytes").remove();a("#snap-changecoverimageconfirmation .ok").addClass("ajaxing");a("#snap-changecoverimageconfirmation").addClass("disabled");var b=k.split("base64,")[1];d.imagedata=b;d.imagefilename=j.name;c.call([{methodname:"theme_snap_cover_image",args:{params:d},done:function done(a){h();if(a.contrast){f("snap-alert-cover-image-size",a.contrast)}if(!a.success&&a.warning){f("snap-alert-cover-image-upload-failed",a.warning)}},fail:function fail(a){h();e.ifErrorShowBestMsg(a)}}],!0,!0)});a("#snap-changecoverimageconfirmation .cancel").click(function(){if(a(this).parent().hasClass("disabled")){return}a("#page-header").css("background-image",a("#page-header").data("servercoverfile"));h()});a("#snap-coverimagecontrol").addClass("snap-js-enabled")};return{courseImage:function courseCoverImage(a,b){j(b,{imagefilename:null,imagedata:null,categoryid:null,courseshortname:a})},categoryImage:function categoryCoverImage(a,b){j(b,{imagefilename:null,imagedata:null,categoryid:a,courseshortname:null})}}});
//# sourceMappingURL=cover_image.min.js.map
